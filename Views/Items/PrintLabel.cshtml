@model ManufacturingTimeTracking.Models.Inventory.Item
@{
    ViewData["Title"] = "Print label";
    var tagCode = ViewBag.TagCode as string ?? Model.Sku;
    var qrUrl = Url.Action("ItemQr", "Items", new { code = tagCode, pixelsPerModule = 6 });
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Label - @Model.Sku</title>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: Arial, sans-serif; background: #eee; padding: 1rem; }
        @@media print {
            @@page { size: 60mm 30mm; margin: 0; }
            body { background: white; padding: 0; margin: 0; }
            .no-print { display: none !important; }
            .label-wrap { box-shadow: none !important; margin: 0 !important; page-break-after: avoid; }
        }
        .label-wrap {
            width: 60mm;
            height: 30mm;
            margin: 0 auto;
            background: white;
            border: 1px solid #ccc;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: flex;
            align-items: stretch;
            padding: 1.5mm;
        }
        .label-qr {
            flex: 0 0 22mm;
            height: 27mm;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .label-qr img {
            width: 22mm;
            height: 22mm;
            object-fit: contain;
        }
        .label-text {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding-left: 2mm;
            font-size: 2.8mm;
            line-height: 1.25;
        }
        .label-text .sku { font-weight: bold; font-size: 3.2mm; }
        .label-text .name { word-break: break-word; }
        .no-print {
            text-align: center;
            margin-top: 1rem;
        }
        .no-print button {
            padding: 0.5rem 1.5rem;
            font-size: 1rem;
            cursor: pointer;
            background: #0d6efd;
            color: white;
            border: none;
            border-radius: 4px;
        }
        .no-print button:hover { background: #0b5ed7; }
    </style>
</head>
<body>
    @if (TempData["Msg"] is string msg && !string.IsNullOrEmpty(msg))
    {
        <p class="no-print" style="text-align:center; color: green; margin-bottom: 0.5rem;">@msg</p>
    }
    <div class="label-wrap">
        <div class="label-qr">
            <img src="@qrUrl" alt="QR @tagCode" />
        </div>
        <div class="label-text">
            <span class="sku">@Model.Sku</span>
            <span class="name">@Model.Name</span>
        </div>
    </div>
    <div class="no-print">
        <button type="button" onclick="window.print();">Print label</button>
        <a href="@Url.Action("Details", "Items", new { id = Model.Id })" style="margin-left:0.5rem;">Back to item</a>
    </div>
    <script>
        if (window.location.search.includes('print=1')) {
            window.onload = function () { window.print(); };
        }
    </script>
</body>
</html>
